## 对照调试参数信息，从log中找出对照速度差异的原因

> 看看log，看看你能不能看出为什么有的是十几步，有的要四十几步才能对好焦。  

>   因为FvChangeRatio吗，对焦变化率大的时候变化快，对好焦就快，但是有一些数据不符合，可能是因为开始对焦的位置不同.  

> 先看看fv ，这个是基础数据  

>   感觉fv没什么规律，除了对焦的时候会变大  




## 连上工具，手动对焦，分别找出8cm和80cm最清晰时候对应的focus位置。与自动对焦的结果比较，看看位置分布情况

> AF设计使用文档  
> 图像质量调优文档-AF调优指南  

1. 可以通过AF的调试信息来看AF的实时输出情况，观察运动检测是否有效  
2. 同时也可以修改VCM的最大最小值以及对焦速度来查看对焦效果的变化   
通过修改VCM（对焦位置）的最大最小值以及Speed（对焦速度）来查看对焦效果的变化：  
SpeedIndex调小之后可以明显发现自动对焦速度变慢。   

操作：
1. 从小到大设置VCM远焦端和近焦端（调完参要写入），并capture抓图，直至截图明显从清晰变模糊为止。     
2. 截图逐渐变清晰，但从350-352到400-402时截图明显从清晰变模糊 
3. 找出这两次测试清晰的画面所对应的vcm_min_code数值  
其中较小的值再减去50（预设模组工差）作为vcm_min_code，其中较大的值再加上50（预设模组工差）作为vcm_max_code。      
4. 缩小范围，对焦位置为min360-max362时画面最清晰
5. 注：报错或无法抓图时，重连   
6. 与自动对焦的结果比较，看看位置分布情况：自动对焦log中VCM对焦位置分布在300~382之间，手动对焦位置符合此范围  

报错：Segmentation fault  
[Segmentation Fault错误原因总结](https://blog.csdn.net/u010150046/article/details/77775114)  


## 有空看看视频和工具的docs文件夹，了解工具怎么使用

> 视频：  
> ISP Tuning Video：V2版本ISP调试工具使用  
> TCS Recording：210508培训  

### ISP Tuning Video

连接方式：1. USB 2. 网口  
板端工具和sdk对应  
1. 首先要杀掉所有占用摄像头的进程  
2. 然后运行板端工具  
3. 然后运行PC端工具  

向导填写：ISP、VIN：打印出vi信息；sensor：根据sensor驱动  

capture：Dump：获取预览画面  


### TCS Recording

**ISP结构与效果优化**  

**ISP硬件**   
DPC：去坏点；CTC：去噪声（迷宫噪声）；GCA：全局色差矫正（矫正紫边）；Denoise：降噪（重点）；BLC：去黑电平（输出线性数据）；  
DG：补偿曝光；WB：白平衡矫正；LSC；DEMOSAIC：去马赛克；SHARP：锐化；  
LCA：局部色差矫正；CCM：色彩矩阵映射；CNR：降彩噪；SATU：饱和度模块（全局）；DRC：动态范围调节（直方图均衡）； 
GAMMA：GAMMA映射，线性图像作非线性映射，更符合人眼感受；RGB2YUV：转；CEM：色彩增强（针对某些色调）；YUV444toYUV422：降采样，转  

**新Sensor调试步骤**  
选择一份调试好的参数作为模板；  
客观标定：  
主观调试：  
Sensor镜头缺陷修复：  
更换镜头  

**ISP各模块处理效果**  
Sensor原始数据(Bayer)  
去马赛克(demosaic)  
黑电平矫正(BLC/SO)  
白平衡(AWB)  
GAMMA矫正  
Shading矫正：镜头边缘偏色  
CCM矫正：色彩还原  
空域降噪(BDNF)：对图像清晰度有影响，主观调试  
时域降噪(TDNF)  
锐化处理(Sharpness)：图像轮廓，不增加细节，不改变清晰度不足  
PLTM(Local Tone Mapping)：提高暗部亮度  
色彩增强(CEM)：饱和度，色调  

**常见效果问题**  
暗部偏色：过小偏紫，过大偏绿，黑电平问题，BLC设置准确OB值  
饱和度：Saturation，主观  
噪声太大：提高降噪强度、降低锐化强度  
清晰度不足：降低降噪强度（黑边强，字体细节模糊）、提高锐化强度（细节多，轮廓不明显）  
图像发虚、模糊：镜头对焦是否正确AF；保护塑料膜  
图像亮度太暗：AE参数AE Targrt（曝光提高，可能过曝）  
色调偏好：AWB参数RGAIN/BGAIN  
炫光鬼影：镜头问题。鬼影：更换镜头、炫光：偏红，更换镜头/红外滤光片  
镜头光晕：镜头问题。镜头表面损伤/粉尘：清理镜头表面/更换镜头  
RGB顺序错误：红蓝翻转/偏紫，sensor驱动RGB顺序设置：GRBG→GBRG，mipi.c-mbus_code  

**调试工具使用**  
Docs文档  
PC端工具Hawkview    
连接方式：1.ADB 2.网口    
Template：保存dat文件    
Register：转换成头文件，编译进文件，烧固件进去    
Calibration：标定  
BLC：黑电平标定  
LSC/MSC：镜头阴影矫正  
WB：白平衡(灯箱下标定   
CCM：色彩还原(灯箱下标定  
GCA：全局色差矫正   
Capture：看图  
IQ Test：验证  
Play：实时预览编码后图像  
ByPassSetting：模块开关  

**调试实例**  
1. 判断黑电平标定是否准确：关闭所有模块，低曝光低增益Y不为零→sensor有黑电平，打开SO模块→扣除黑电平→Y为零   
（增益：256一倍；曝光：16一行）  







